/*
 *  jjsearch.js - v1.0.0
 *  lite search engine writen in JS to process JSON
 *  https://github.com/EldonMcGuinness/jjsearch.js
 *
 *  Made by Eldon McGuinness
 *  Under MIT License
 *
 *  Parameters:
 *  callback: A function to be run when the search results returns
 *  source: the source of the search string, this is needed so the
 *      querystring can be parsed and populated into it when the
 *      page loads.
 *  debug: enables debug logging to the console.
 */
var jjsearch=function(e,t,s){this.qsdebug=s||!1,this.source=document.getElementById(t)||"",this.callback=e||null;var n=this;window.onload=function(){var e=jjsearch.querystring();"object"==typeof e.q?e=e.q[0]:"string"==typeof e.q&&(e=e.q),"string"==typeof e&&(n.source.value=n.doSearch(e))},this.getHits=function(e,t){var s=[];if(!Array.isArray(e)){e=[e.replace(/\s*[\+\*\?]\s*/g,".*").replace("||","|")],1==this.qsdebug&&console.log(e);for(var n=0;n<t.length;n++)for(var o=0;o<e.length&&!this.linkExists(t[n],s);o++)if(1==this.qsdebug&&console.log("Counts ["+n+"]["+o+"]"),1==this.qsdebug&&console.log("Checking Title ["+t[n].title+"]["+e[o]+"]"),t[n].title.search(new RegExp(e[o],"i"))>-1||t[n].content.search(new RegExp(e[o],"i"))>-1){s.push(t[n]);break}return 1==this.qsdebug&&console.log(s),s}1==this.qsdebug&&console.log("array found")},this.linkExists=function(e,t){1==this.qsdebug&&console.log(e),1==this.qsdebug&&console.log(t);for(var s=0;s<t.length;s++)if(1==this.qsdebug&&console.log("comparing"+e.link+"|"+t[s].link),e.link==t[s].link)return!0;return!1},this.populateResults=function(e){this.callback(e)},this.doSearch=function(e){var t="",s=this,n=new XMLHttpRequest;return t=null==e?this.source.value.trim():e,t.length<4?(this.callback(1),t):(n.open("GET","/search.json",!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=s.getHits(t,JSON.parse(n.response));s.populateResults(e)}},n.send(),t)}};jjsearch.querystring=function(e){var t={},s=e||document.location.search;if(""==s)return t;for(s=s.replace(/(^\?)/,"").replace(/;/g,"&");-1!=s.indexOf("&&");)s=s.replace(/&&/g,"&");s=s.replace(/([\&]+$)/,""),s=s.split("&");for(var n=0;n<s.length;n++){var o=s[n].split("=");if(o=o.map(function(e){return decodeURIComponent(e)}),void 0!=t[o[0]])if("string"==typeof t[o[0]]){var r=t[o[0]];""==o[1]&&(o[1]=null),t[o[0]]=[],t[o[0]].push(r),t[o[0]].push(o[1])}else"object"==typeof t[o[0]]&&(""==o[1]&&(o[1]=null),t[o[0]].push(o[1]));else""==o[1]&&(o[1]=null),t[o[0]]=o[1]}return t};